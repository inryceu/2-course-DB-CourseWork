# Звіт про структуру бази даних ігрової платформи

## Таблиця: `users`

**Призначення:**
Зберігає інформацію про облікові записи користувачів платформи.

### Стовпці

| Стовпець      | Тип           | Обмеження        | Опис                                 |
| ------------- | ------------- | ---------------- | ------------------------------------ |
| id            | SERIAL        | PRIMARY KEY      | Унікальний ідентифікатор користувача |
| username      | VARCHAR(20)   | UNIQUE, NOT NULL | Ім’я користувача                     |
| email         | VARCHAR(255)  | UNIQUE, NOT NULL | Email користувача                    |
| password_hash | VARCHAR(255)  | NOT NULL         | Хеш пароля                           |
| age           | INT           | NOT NULL         | Вік користувача                      |
| region        | CHAR(2)       | NOT NULL         | Регіон (ISO-код)                     |
| avatar        | VARCHAR(2083) | NULL             | Посилання на аватар                  |
| created_at    | TIMESTAMP     | DEFAULT NOW()    | Дата створення                       |
| last_login    | TIMESTAMP     | NULL             | Останній вхід                        |

### Індекси

* `region`
* `created_at`
* `last_login`

### Зв’язки

* Один-до-багатьох з `libraries`
* Один-до-багатьох з `reviews`
* Один-до-багатьох з `saves`
* Багато-до-багатьох з `users` через `friends`
* Багато-до-багатьох з `achievements` через `user_achieve_connection`

---

## Таблиця: `games`

**Призначення:**
Зберігає основну інформацію про ігри.

### Стовпці

| Стовпець            | Тип           | Обмеження        | Опис              |
| ------------------- | ------------- | ---------------- | ----------------- |
| id                  | SERIAL        | PRIMARY KEY      | Ідентифікатор гри |
| title               | VARCHAR(50)   | UNIQUE, NOT NULL | Назва гри         |
| price               | DECIMAL(6,2)  | NULL             | Ціна              |
| release_date        | DATE          | NOT NULL         | Дата релізу       |
| age_rating          | VARCHAR(3)    | NOT NULL         | Віковий рейтинг   |
| cover               | VARCHAR(2083) | NOT NULL         | Обкладинка        |
| description         | TEXT          | NULL             | Опис гри          |
| system_requirements | JSON          | NOT NULL         | Системні вимоги   |
| base_game_id        | INT           | NULL             | Базова гра (DLC)  |
| is_multiplayer      | BOOLEAN       | DEFAULT FALSE    | Мультиплеєр       |

### Індекси

* `release_date`
* `base_game_id`
* `is_multiplayer`

### Зв’язки

* Самозв’язок (базова гра → DLC)
* Один-до-багатьох з `achievements`
* Один-до-багатьох з `events`
* Один-до-багатьох з `game_news`
* Багато-до-багатьох з `devs`
* Багато-до-багатьох з `tags`
* Один-до-багатьох з `libraries`
* Один-до-багатьох з `reviews`
* Один-до-багатьох з `saves`

---

## Таблиця: `devs`

**Призначення:**
Містить інформацію про розробників та видавців.

### Стовпці

| Стовпець | Тип           | Обмеження        | Опис                           |
| -------- | ------------- | ---------------- | ------------------------------ |
| id       | SERIAL        | PRIMARY KEY      | Ідентифікатор                  |
| dev_name | VARCHAR(50)   | UNIQUE, NOT NULL | Назва компанії                 |
| contacts | JSON          | NOT NULL         | Контактні дані                 |
| logo     | VARCHAR(2083) | NULL             | Логотип                        |
| dev_type | ENUM          | NOT NULL         | Тип (developer/publisher/both) |

### Індекси

* `dev_type`

### Зв’язки

* Багато-до-багатьох з `games` через `game_dev_connection`

---

## Таблиця: `achievements`

**Призначення:**
Зберігає досягнення, доступні в іграх.

### Стовпці

| Стовпець | Тип           | Обмеження   | Опис             |
| -------- | ------------- | ----------- | ---------------- |
| id       | SERIAL        | PRIMARY KEY | Ідентифікатор    |
| game_id  | INT           | NOT NULL    | Гра              |
| title    | VARCHAR(64)   | NOT NULL    | Назва досягнення |
| icon     | VARCHAR(2083) | NOT NULL    | Іконка           |

### Індекси

* `game_id`

### Зв’язки

* Багато-до-одного з `games`
* Багато-до-багатьох з `users`

---

## Таблиця: `libraries`

**Призначення:**
Зберігає бібліотеку ігор користувачів.

### Стовпці

| Стовпець        | Тип    | Обмеження   | Опис                |
| --------------- | ------ | ----------- | ------------------- |
| id              | SERIAL | PRIMARY KEY | Ідентифікатор       |
| user_id         | INT    | NOT NULL    | Користувач          |
| game_id         | INT    | NOT NULL    | Гра                 |
| hours_played    | INT    | DEFAULT 0   | Награні години      |
| ownership       | ENUM   | NOT NULL    | Тип володіння       |
| download_status | ENUM   | NULL        | Статус завантаження |

### Індекси

* `user_id`
* `game_id`
* `ownership`
* `(user_id, ownership)`

### Зв’язки

* Багато-до-одного з `users`
* Багато-до-одного з `games`

---

## Таблиця: `friends`

**Призначення:**
Реалізує соціальні зв’язки між користувачами.

### Стовпці

| Стовпець  | Тип  | Обмеження       | Опис      |
| --------- | ---- | --------------- | --------- |
| user_id   | INT  | PK              | Ініціатор |
| friend_id | INT  | PK              | Друг      |
| status    | ENUM | DEFAULT pending | Статус    |

### Індекси

* `user_id`
* `friend_id`
* `status`

### Зв’язки

* Самозв’язок з `users`

---

## Таблиця: `reviews`

**Призначення:**
Зберігає відгуки користувачів на ігри.

### Стовпці

| Стовпець | Тип    | Обмеження   | Опис          |
| -------- | ------ | ----------- | ------------- |
| id       | SERIAL | PRIMARY KEY | Ідентифікатор |
| user_id  | INT    | NOT NULL    | Автор         |
| game_id  | INT    | NOT NULL    | Гра           |
| rating   | INT    | NOT NULL    | Оцінка        |
| content  | TEXT   | NULL        | Текст відгуку |

### Індекси

* `user_id`
* `game_id`
* `rating`
* `(game_id, rating)`

---

## Таблиця: `events`

**Призначення:**
Зберігає події, пов’язані з іграми (знижки, акції).

### Стовпці

| Стовпець   | Тип          | Обмеження   | Опис          |
| ---------- | ------------ | ----------- | ------------- |
| id         | SERIAL       | PRIMARY KEY | Ідентифікатор |
| game_id    | INT          | NOT NULL    | Гра           |
| discount   | DECIMAL(5,2) | NULL        | Знижка        |
| start_date | DATE         | NOT NULL    | Початок       |
| end_date   | DATE         | NOT NULL    | Кінець        |
| type       | ENUM         | NOT NULL    | Тип події     |

### Індекси

* `game_id`
* `(start_date, end_date)`
* `type`

---

## Таблиця: `game_news`

**Призначення:**
Новини та оновлення ігор.

### Стовпці

| Стовпець     | Тип          | Обмеження     | Опис            |
| ------------ | ------------ | ------------- | --------------- |
| id           | SERIAL       | PRIMARY KEY   | Ідентифікатор   |
| game_id      | INT          | NOT NULL      | Гра             |
| title        | VARCHAR(200) | NOT NULL      | Заголовок       |
| content      | TEXT         | NOT NULL      | Текст           |
| published_at | TIMESTAMP    | DEFAULT NOW() | Дата публікації |

### Індекси

* `game_id`
* `published_at`

---

## Таблиця: `tags`

**Призначення:**
Категоризація ігор за тегами.

### Стовпці

| Стовпець | Тип         | Обмеження   | Опис          |
| -------- | ----------- | ----------- | ------------- |
| id       | SERIAL      | PRIMARY KEY | Ідентифікатор |
| tag_name | VARCHAR(25) | UNIQUE      | Назва тегу    |

---

## Рішення щодо дизайну

### Вибір структури схеми

Структура схеми бази даних була обрана з урахуванням вимог до ігрової платформи, яка поєднує комерційні, соціальні та ігрові функції. Центральними сутностями є `users` та `games`, навколо яких побудовані допоміжні таблиці для зберігання відгуків, бібліотек, досягнень, новин і соціальних зв’язків.

Для реалізації зв’язків типу **багато-до-багатьох** (користувачі–друзі, ігри–розробники, ігри–теги, користувачі–досягнення) використано проміжні таблиці (`friends`, `game_dev_connection`, `game_tag_connection`, `user_achieve_connection`). Такий підхід забезпечує гнучкість схеми, спрощує розширення функціоналу та запобігає дублюванню даних.

Самозв’язок у таблиці `games` (через `base_game_id`) дозволяє коректно моделювати DLC та доповнення без створення окремих таблиць.

---

### Досягнутий рівень нормалізації

Схема бази даних відповідає **третій нормальній формі (3NF)**:

* **1NF:**
  Усі таблиці мають атомарні значення, відсутні повторювані групи полів.
* **2NF:**
  Усі неключові атрибути повністю залежать від первинного ключа (у таблицях зі складеним ключем — від усього ключа).
* **3NF:**
  Відсутні транзитивні залежності між неключовими атрибутами.

Довідкові значення (типи подій, статуси друзів, типи володіння) винесені в `enum`, що зменшує ймовірність помилкових значень і підвищує цілісність даних.

---

### Зроблені компроміси

* **Використання JSON-полів (`system_requirements`, `contacts`, `save_data`)**
  Це порушує строгий підхід до нормалізації, однак дозволяє зберігати гнучкі, напівструктуровані дані без створення великої кількості допоміжних таблиць. Такий компроміс виправданий рідкісною потребою у складних SQL-запитах до цих даних.

* **Відсутність soft-delete**
  Для спрощення логіки та зменшення складності схеми видалення реалізоване фізично (`ON DELETE CASCADE`) у зв’язкових таблицях.

* **ENUM замість окремих довідникових таблиць**
  ENUM-типи спрощують схему і підвищують читабельність, однак ускладнюють зміну переліку значень без міграцій.

---

### Стратегія індексування

Індексація побудована з урахуванням типових сценаріїв використання платформи:

* **Пошук і фільтрація**

  * `users(region, created_at)`
  * `games(release_date, is_multiplayer)`
  * `reviews(game_id, rating)`

* **Зв’язки між таблицями**

  * Індекси на всі зовнішні ключі (`user_id`, `game_id`, `dev_id`, `tag_id`)
  * Композитні індекси для таблиць-зв’язків

* **Часті бізнес-запити**

  * `libraries(user_id, ownership)` — швидкий доступ до бібліотеки користувача
  * `events(start_date, end_date)` — активні акції
  * `game_news(published_at)` — сортування новин за часом

Такий підхід дозволяє досягти балансу між швидкістю читання даних і накладними витратами на запис та зберігання індексів.

---

### Висновок

Обрана структура схеми забезпечує масштабованість, цілісність даних і високу продуктивність. Досягнутий рівень нормалізації мінімізує надлишковість, а зроблені компроміси є свідомими та виправданими з точки зору практичного використання системи.

---
